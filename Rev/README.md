This folder contains everything needed to run RevBayes analyses of the 2013 bison data and to perform some basic testing of the Rev implementation of the HSMRF coalescent.

For stability, these can all be run with the development branch of the fork of Rev available at: https://github.com/afmagee/revbayes/

# Installation of the fork of Revbayes

Installing RevBayes on linux/Mac requires Cmake and a C++ compiler. With these in place, the process should be as easy as:
    
    1. cd revbayes/projects/cmake
    2. ./build.sh

There are further instructions available [here](http://revbayes.github.io/software.html) for linux/Mac, and in revbayes/projects/RevBayes\_Win\_Installation\_Instruction.txt for windows users. If using these instructions, be sure to clone from https://github.com/afmagee/revbayes.git and not https://github.com/revbayes/revbayes.git.

# Running analyses

To run any tests or analyses, Rev should be compiled from this source, and called from the top level of /analyses or /tests as appropriate.

### Running analyses of Bison data
    
    1. Generate analysis scripts by opening R in the Rev folder and sourcing "/analyses/setup/generate_analysis_scripts.R". The number of replicates and seed are set here
    2. Call RevBayes from Rev/analyses on the scripts in Rev/analyses/src, output will be printed to Rev/analyses/output
    
### Running analyses of simulated data
There are two sets of analyses here, fixed-tree analyses of only the coalescent model (in /tree\_only) and joint analyses (coalescent model and tree, in /full\_model).
Start by generating the necessary scripts for Rev then source the scripts in Rev:

    1. Generate analysis scripts by opening R in the Rev folder and sourcing "/tests/setup/generate_test_scripts.R". 
    2. Call RevBayes from Rev/tests/ on the scripts in Rev/tests/tree_only/src and Rev/tests/full_model/src, output will be printed to Rev/tree_only/output and Rev/full_model/output


Note that the following steps were already taken to produce the necessary data files and do not need to be repeated:

    1. Simulated coalescent topologies (Rev/tests/setup/simtraj.R)
    2. Made Rev taxon files (Rev/tests/setup/simtraj.R)
    3. Created smaller, subsampled, trees for testing joint inference (Rev/tests/setup/subsample_trees_for_full_Rev_test.R)
    4. Simulated alignments on subsampled trees to test joint inference (Rev/tests/setup/sim_seqs.Rev)


# File structure
    
    /analyses contains the requisite scripts and files for analyzing the data
    
        /analyses/data contains the Bison data
        
        /analyses/output is where the output of the analyses go
        
        /analyses/setup
            
            To generate the scripts for analysis, use /analyses/setup/generate_analysis_scripts.R 
            
                The number of replicate analyses can be changed by altering this file
            
            To change any details of the HSMRF or GMRF analyses, alter the templates and re-generate the analysis files
    
        /analyses/src contains the scripts to run the analyses
        
        
    /tests contains scripts to simulate and perform basic sanity checks of the Rev implementation of the HSRF and GMRF models
        
        /setup contains scripts and datafiles to simulate test datasets and write test analysis scripts
            
            /simtraj.R is used for simulating coalescent models (need phylofuncs.R, package phylodyn)
            
            /write_taxa.Rev creates taxon objects for the simulated trees from simtraj.R
            
            /subsample_trees_for_full_Rev_test.R makes smaller versions of the full trees to use in testing the joint/full model in Rev
            
            /sim_seqs.Rev simulates JC69 alignments on the subsampled trees (using clock rates that correspond roughly to the substitution (MrBayes-style) tree length of the Bison data
            
            /generate_test_scripts.R generates the Rev scripts for analysis, uses the misc. text files to set grid ends and priors where needed in the Rev scripts
            
            /phylofuncs.R contains helper functions for simtraj.R
            
            /misc .txt files are generated by these scripts and used to plug in values to the template Rev scripts
        
        /tree_only is for testing the Rev HSMRF and GMRF implementations on fixed trees
            
            /data contains simulated data    
            
            /output holds the output of the analyses
            
            /src contains the generated analysis scripts
    
        /full_model is for testing the Rev HSMRF and GMRF implementations while inferring the tree
            
            /data contains simulated data    
            
            /output holds the output of the analyses
            
            /src contains the generated analysis scripts
    

    
